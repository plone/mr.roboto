<html>
    <head>
        <title>Mr. Roboto</title>
        <link href='http://fonts.googleapis.com/css?family=Raleway:400,700' rel='stylesheet' type='text/css'/>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet"/>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
        <style>
            body {
                background-color: rgb(0,149,211);
                font-family: 'Raleway', sans-serif;
            }
            h2 {

            }
            ul {
                list-style-type: none
            }
            .field input{
            }
            textarea {
                width: 300px;
            }
            form {
                margin-left: 20px;
            }
            #crud-button {
                margin-left: 20px;
                margin-top: 20px;
            }
            a {
                color: white;
            }
        </style>
        <script>
            $(document).ready(function(){
                $('#crud-button').click(function(){
                    $('#crud').toggle();
                });
                $('#crud').hide();
                $('.editplip').click(function(event){
                    var plip = $(this).parent().parent();
                    $('#input-description').val(plip.find('.description').html());
                    var repo_to_edit = "";
                    plip.find('.repo').each(function(){ 
                        repo_to_edit += $(this).html()+'\n';
                    })

                    $('#input-repo').val(repo_to_edit);

                    $('#input-buildout').val(plip.find('.buildout').val());
                    $('#input-buildout_branch').val(plip.find('.buildout_branch').val());
                    $('#shell').val(plip.find('.buildout_file').val());
                    $('#input-url').val(plip.find('.url').val());
                    $('#input-contact').val(plip.find('.contact').val());
                    if (plip.find('.robot_tests').val() == "True") {
                        $('#input-robot_tests').attr('checked', true);
                    } else {
                        $('#input-robot_tests').attr('checked', false);
                    }

                    $('#crud').show();
                })
                $('.removeplip').click(function(event){
                    apikey = prompt('API key?');
                    description = $(this).parent().parent().find('.description').html();
                    data = {'key': apikey, 'description': description, 'action': 'delete'};
                    jQuery.ajax({
                        type: "POST",
                        dataType: "json",
                        url: 'plips',
                        data: data, 
                        success: function(data) {
                            $('.'+description).remove();
                        }
                    })
                })
                $('#basic_buildout').click(function(event){
                    event.preventDefault(); 
                    $('#shell').html("$PYTHON27 bootstrap.py -c jenkins.cfg\n\
bin/buildout -c jenkins.cfg\n\
bin/jenkins-test\n\
bin/jenkins-code-analysis\n\
bin/jenkins-test-coverage");
                });
            });
        </script>
    </head>
    <body>
        <button id="crud-button" class="btn">Admin</button>
        <div id="crud" class="row">
            <div class="span12">
            <form id="form" action="plips" method="POST">
                <h3>Add new plip to test</h3>
                <div class="field">
                <label>description - key</label>
                <input id="input-description" type="text" name="description"/>
                </div>

                <div class="field">
                    <label>list of repo and branches to hook (plone/plone.app.multilingual master)</label>
                    <textarea rows="4" cols="70" id="input-repo" name="repo"></textarea>
                </div>
                <div class="field">
                <label>git repo with buildout to test (http://github.com/plone/plone.app.multilingual.git)</label>
                <input type="text" id="input-buildout" name="buildout"/>
                </div>
                <div class="field">
                <label>git repo branch to test (master)</label>
                <input type="text" id="input-buildout_branch" name="buildout_branch"/>
                </div>
                <div class="field">
                <label>jenkins buildout configuration on repo</label>
                <textarea id="shell" rows="4" cols="50" id="input-buildout_file" name="buildout_file"></textarea>
                <button class="btn" id="basic_buildout">Basic</button>
                <button class="btn" id="coverage">Coverage</button>
                </div>
                <div class="field">
                <label>Robot test results ?</label>
                <input id="input-robot_tests" type="checkbox" name="robot_test"/>
                </div>
                <div class="field">
                <label>url of plip reference</label>
                <input type="text" id="input-url" name="url"/>
                </div>
                <div class="field">
                <label>contact mails (plone@plone.org, jenkins@plone.org)</label>
                <input type="text" id="input-contact" name="contact"/>
                </div>
                <div class="field">
                <label>api key</label>
                <input type="password" name="key"/>
                </div>
                <input type="hidden" name="action" value="add"/>
                <input type="submit" value="send"/>
            </form>
            </div>
        </div>
        <div id="options">
            <table class="table">
                <thead>
                    <tr>
                      <th>Description</th>
                      <th>Repo</th>
                      <th>JK URL</th>
                      <th>REF URL</th>
                    </tr>
                </thead>
                <!-- XXX Would be great to have a sorted table -->
                <tal:block repeat="plip plips">
                <tr tal:attributes="class python:plip['description']">
                    <td tal:content="python:plip['description']" class='description'>description</td>
                    <td> 
                        <ul>
                            <li tal:repeat="repo python:plip['repo']" class='repo'><span tal:replace="python:repo[0]">repo</span> <span tal:replace="python:repo[1]">repo</span></li>
                        </ul>
                    </td>

                    <input type="hidden" class="buildout" value="" tal:attributes="value plip['buildout']"/>
                    <input type="hidden" class="buildout_branch" value="" tal:attributes="value plip['buildout_branch']"/>
                    <input type="hidden" class="buildout_file" value="" tal:attributes="value plip['buildout_file']"/>
                    <input type="hidden" class="url" value="" tal:attributes="value plip['url']"/>
                    <input type="hidden" class="contact" value="" tal:attributes="value plip['contact']"/>
                    <input type="hidden" class="robot_tests" value="" tal:attributes="value plip['robot_tests']"/>

                    <td> <a href="" tal:attributes="href python:plip['jk_url']">repo</a></td>
                    <td> <a href="" tal:attributes="href python:plip['url']">PLIP url</a></td>

                    <td> <button class="btn editplip">Edit</button></td>
                    <td> <button class="btn removeplip">Remove</button></td>

                </tr>
                </tal:block>
            </table>
        </div>
    </body>
</html>